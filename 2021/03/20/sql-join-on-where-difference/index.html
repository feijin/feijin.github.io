<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>Inner join、Outer join、Full join中on与where的区别 | 天马行空</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="背景本文主要讨论hive中，不同join方式下on条件和where条件的区别，同时关注hive中如何执行语句。比如谓词下推，就是其中一种优化技术。 原表person表 person.id       person.name     person.age3       mili    214       tom     195       mike    188       nul     20ac">
<meta name="keywords" content="Blog">
<meta property="og:type" content="article">
<meta property="og:title" content="Inner join、Outer join、Full join中on与where的区别">
<meta property="og:url" content="https://feijin.github.io/2021/03/20/sql-join-on-where-difference/index.html">
<meta property="og:site_name" content="天马行空">
<meta property="og:description" content="背景本文主要讨论hive中，不同join方式下on条件和where条件的区别，同时关注hive中如何执行语句。比如谓词下推，就是其中一种优化技术。 原表person表 person.id       person.name     person.age3       mili    214       tom     195       mike    188       nul     20ac">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2021-03-21T08:52:56.912Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Inner join、Outer join、Full join中on与where的区别">
<meta name="twitter:description" content="背景本文主要讨论hive中，不同join方式下on条件和where条件的区别，同时关注hive中如何执行语句。比如谓词下推，就是其中一种优化技术。 原表person表 person.id       person.name     person.age3       mili    214       tom     195       mike    188       nul     20ac">
  
  <link rel="stylesheet" href="/css/index.css">
  <meta name="google-site-verification" content="eUv3pkAv7EcIQ2htUnYRsPtpEiYSfC0jlZ0EH3EgLUA">
</head>
</html>
<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">ZHUIYUAN</a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
    </div>
    <div class="menu">
      
        
            <a href="/" class="nav-menu ">BLOG</a>
          
        
            <a href="/categories" class="nav-menu ">ARCHIVE</a>
          
        
            <a href="/about" class="nav-menu ">ABOUT</a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">Inner join、Outer join、Full join中on与where的区别</h2>
  <p class="sub">Mar 20, 2021, 9:58 am</p>
  <article class="content">
    <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>本文主要讨论hive中，不同join方式下on条件和where条件的区别，同时关注hive中如何执行语句。比如谓词下推，就是其中一种优化技术。</p>
<h3 id="原表"><a href="#原表" class="headerlink" title="原表"></a>原表</h3><p>person表</p>
<p><pre>person.id       person.name     person.age<br>3       mili    21<br>4       tom     19<br>5       mike    18<br>8       nul     20</pre><br>account表</p>
<p><pre>account.id      account.account<br>1       2222<br>2       2323<br>3       1111<br>4       1212<br>5       5555<br>6       6666</pre></p>
<h3 id="Inner-join"><a href="#Inner-join" class="headerlink" title="Inner join"></a>Inner join</h3><p>通常情况下简写为join<br>inner join，查询条件在on中和where中，执行结果上并没有不同。<br>比如，下面几个查询语句执行结果相同<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">and</span> person.id=<span class="number">4</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">and</span> account.id=<span class="number">4</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">where</span> person.id=<span class="number">4</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">where</span> account.id=<span class="number">4</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">and</span> person.id=<span class="number">4</span> <span class="keyword">and</span> account.id=<span class="number">4</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">where</span> person.id=<span class="number">4</span> <span class="keyword">and</span> account.id=<span class="number">4</span>;</span><br></pre></td></tr></table></figure></p>
<p><em>执行结果</em>：<pre>person.id       person.name     person.age      account.id      account.account<br>4       tom     19      4       1212</pre><br>通过explain查看上述执行语句转换的mapreduce任务，所有的任务都被转化为相同的执行计划：</p>
<p><pre>hive (test)&gt; explain select * from person join account on person.id=account.id and person.id=4 and account.id=4;<br>OK<br>Explain<br>STAGE DEPENDENCIES:<br>  Stage-4 is a root stage<br>  Stage-3 depends on stages: Stage-4<br>  Stage-0 depends on stages: Stage-3<br>STAGE PLANS:<br>  Stage: Stage-4<br>    Map Reduce Local Work<br>      Alias -&gt; Map Local Tables:<br>        person<br>          Fetch Operator<br>            limit: -1<br>      Alias -&gt; Map Local Operator Tree:<br>        person<br>          TableScan<br>            alias: person<br>            Statistics: Num rows: 1 Data size: 38 Basic stats: COMPLETE Column stats: NONE<br>            Filter Operator<br>              predicate: (id = 4) (type: boolean)<br>              Statistics: Num rows: 1 Data size: 38 Basic stats: COMPLETE Column stats: NONE<br>              HashTable Sink Operator<br>                keys:<br>                  0 4 (type: int)<br>                  1 4 (type: int)<br>  Stage: Stage-3<br>    Map Reduce<br>      Map Operator Tree:<br>          TableScan<br>            alias: account<br>            Statistics: Num rows: 5 Data size: 42 Basic stats: COMPLETE Column stats: NONE<br>            Filter Operator<br>              predicate: (id = 4) (type: boolean)<br>              Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: NONE<br>              Map Join Operator<br>                condition map:<br>                     Inner Join 0 to 1<br>                keys:<br>                  0 4 (type: int)<br>                  1 4 (type: int)<br>                outputColumnNames: _col1, _col2, _col7<br>                Statistics: Num rows: 2 Data size: 17 Basic stats: COMPLETE Column stats: NONE<br>                Select Operator<br>                  expressions: 4 (type: int), _col1 (type: string), _col2 (type: int), 4 (type: int), _col7 (type: int)<br>                  outputColumnNames: _col0, _col1, _col2, _col3, _col4<br>                  Statistics: Num rows: 2 Data size: 17 Basic stats: COMPLETE Column stats: NONE<br>                  File Output Operator<br>                    compressed: false<br>                    Statistics: Num rows: 2 Data size: 17 Basic stats: COMPLETE Column stats: NONE<br>                    table:<br>                        input format: org.apache.hadoop.mapred.SequenceFileInputFormat<br>                        output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat<br>                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe<br>      Local Work:<br>        Map Reduce Local Work<br>  Stage: Stage-0<br>    Fetch Operator<br>      limit: -1<br>      Processor Tree:<br>        ListSink<br>Time taken: 0.253 seconds, Fetched: 62 row(s)</pre><br>不管是account表还是person表，TableScan中均包含“predicate: (id = 4)”这条查询条件，这就意味着读取2个表的数据是先根据条件筛选数据，然后再做join操作。<br>总结：inner join中筛选条件在on或where中，没有差异，因为hive在底层做了逻辑方面的优化，不同的语句被转化为相同的执行任务。</p>
<h3 id="Outer-join"><a href="#Outer-join" class="headerlink" title="Outer join"></a>Outer join</h3><p>以left outer join为例, 通常简写为left join. on条件不会影响左表返回的结果，仅影响右表，where条件会影响左表返回结果。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 1.1</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">left</span> <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">and</span> person.id=<span class="number">4</span>;</span><br></pre></td></tr></table></figure></p>
<p>执行结果：</p>
<p><pre>person.id       person.name     person.age      account.id      account.account<br>3       mili    21      NULL    NULL<br>4       tom     19      4       1212<br>5       mike    18      NULL    NULL<br>8       nul     20      NULL    NULL</pre><br>执行计划：<br>无论左表还是右表，均全量读取。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 1.2</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">left</span> <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">and</span> account.id=<span class="number">4</span>;</span><br></pre></td></tr></table></figure></p>
<p>执行结果：</p>
<p><pre>同sql 1.1</pre><br>执行计划：</p>
<p><pre>hive (test)&gt; explain select * from person left join account on person.id=account.id and account.id=4;<br>OK<br>Explain<br>STAGE DEPENDENCIES:<br>  Stage-4 is a root stage<br>  Stage-3 depends on stages: Stage-4<br>  Stage-0 depends on stages: Stage-3<br>STAGE PLANS:<br>  Stage: Stage-4<br>    Map Reduce Local Work<br>      Alias -&gt; Map Local Tables:<br>        account<br>          Fetch Operator<br>            limit: -1<br>      Alias -&gt; Map Local Operator Tree:<br>        account<br>          TableScan<br>            alias: account<br>            Statistics: Num rows: 5 Data size: 42 Basic stats: COMPLETE Column stats: NONE<br>            Filter Operator<br>              predicate: (id = 4) (type: boolean)<br>              Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: NONE<br>              HashTable Sink Operator<br>                keys:<br>                  0 id (type: int)<br>                  1 id (type: int)<br>  Stage: Stage-3<br>    Map Reduce<br>      Map Operator Tree:<br>          TableScan<br>            alias: person<br>            Statistics: Num rows: 1 Data size: 38 Basic stats: COMPLETE Column stats: NONE<br>            Map Join Operator<br>              condition map:<br>                   Left Outer Join0 to 1<br>              keys:<br>                0 id (type: int)<br>                1 id (type: int)<br>              outputColumnNames: _col0, _col1, _col2, _col6, _col7<br>              Statistics: Num rows: 2 Data size: 17 Basic stats: COMPLETE Column stats: NONE<br>              Select Operator<br>                expressions: _col0 (type: int), _col1 (type: string), _col2 (type: int), _col6 (type: int), _col7 (type: int)<br>                outputColumnNames: _col0, _col1, _col2, _col3, _col4<br>                Statistics: Num rows: 2 Data size: 17 Basic stats: COMPLETE Column stats: NONE<br>                File Output Operator<br>                  compressed: false<br>                  Statistics: Num rows: 2 Data size: 17 Basic stats: COMPLETE Column stats: NONE<br>                  table:<br>                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat<br>                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat<br>                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe<br>      Local Work:<br>        Map Reduce Local Work<br>  Stage: Stage-0<br>    Fetch Operator<br>      limit: -1<br>      Processor Tree:<br>        ListSink<br>Time taken: 0.349 seconds, Fetched: 59 row(s)</pre><br>左表全量读取，右表仅读取account.id=4的数据。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 1.3</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">left</span> <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">and</span> person.id=<span class="number">4</span> <span class="keyword">and</span> account.id=<span class="number">4</span>;</span><br></pre></td></tr></table></figure></p>
<p>执行结果：</p>
<p><pre>同sql 1.2</pre><br>执行计划：<br>同sql 1.2。<br>等价于person.id加不加都不影响结果和执行过程。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 1.4</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">left</span> <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">where</span> person.id=<span class="number">4</span>;</span><br></pre></td></tr></table></figure></p>
<p>执行结果：</p>
<p><pre>person.id       person.name     person.age      account.id      account.account<br>4       tom     19      4       1212</pre><br>执行计划：</p>
<p><pre>hive (test)&gt; explain select * from person left join account on person.id=account.id where person.id=4;<br>OK<br>Explain<br>STAGE DEPENDENCIES:<br>  Stage-4 is a root stage<br>  Stage-3 depends on stages: Stage-4<br>  Stage-0 depends on stages: Stage-3<br>STAGE PLANS:<br>  Stage: Stage-4<br>    Map Reduce Local Work<br>      Alias -&gt; Map Local Tables:<br>        account<br>          Fetch Operator<br>            limit: -1<br>      Alias -&gt; Map Local Operator Tree:<br>        account<br>          TableScan<br>            alias: account<br>            Statistics: Num rows: 5 Data size: 42 Basic stats: COMPLETE Column stats: NONE<br>            Filter Operator<br>              predicate: (id = 4) (type: boolean)<br>              Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: NONE<br>              HashTable Sink Operator<br>                keys:<br>                  0 id (type: int)<br>                  1 id (type: int)<br>  Stage: Stage-3<br>    Map Reduce<br>      Map Operator Tree:<br>          TableScan<br>            alias: person<br>            Statistics: Num rows: 1 Data size: 38 Basic stats: COMPLETE Column stats: NONE<br>            Filter Operator<br>              predicate: (id = 4) (type: boolean)<br>              Statistics: Num rows: 1 Data size: 38 Basic stats: COMPLETE Column stats: NONE<br>              Map Join Operator<br>                condition map:<br>                     Left Outer Join0 to 1<br>                keys:<br>                  0 id (type: int)<br>                  1 id (type: int)<br>                outputColumnNames: _col1, _col2, _col6, _col7<br>                Statistics: Num rows: 2 Data size: 17 Basic stats: COMPLETE Column stats: NONE<br>                Select Operator<br>                  expressions: 4 (type: int), _col1 (type: string), _col2 (type: int), _col6 (type: int), _col7 (type: int)<br>                  outputColumnNames: _col0, _col1, _col2, _col3, _col4<br>                  Statistics: Num rows: 2 Data size: 17 Basic stats: COMPLETE Column stats: NONE<br>                  File Output Operator<br>                    compressed: false<br>                    Statistics: Num rows: 2 Data size: 17 Basic stats: COMPLETE Column stats: NONE<br>                    table:<br>                        input format: org.apache.hadoop.mapred.SequenceFileInputFormat<br>                        output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat<br>                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe<br>      Local Work:<br>        Map Reduce Local Work<br>  Stage: Stage-0<br>    Fetch Operator<br>      limit: -1<br>      Processor Tree:<br>        ListSink<br>Time taken: 0.228 seconds, Fetched: 62 row(s)</pre><br>执行计划表明，无论是左表还是右表，均在读取数据时做了筛选，然后执行join。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 1.5</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">left</span> <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">where</span> account.id=<span class="number">4</span>;</span><br></pre></td></tr></table></figure></p>
<p>执行结果：</p>
<p><pre>同sql 1.4</pre><br>执行计划：<br>无论左表还是右表，均全量读取。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 1.6</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">left</span> <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">where</span> person.id=<span class="number">4</span> <span class="keyword">and</span> account.id=<span class="number">4</span>;</span><br></pre></td></tr></table></figure></p>
<p>执行结果：</p>
<p><pre>同sql 1.4</pre><br>执行计划：<br>同sql1.4。</p>
<h3 id="Full-join"><a href="#Full-join" class="headerlink" title="Full join"></a>Full join</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 2.1</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">full</span> <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id;</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<p><pre>person.id       person.name     person.age      account.id      account.account<br>NULL    NULL    NULL    1       2222<br>NULL    NULL    NULL    2       2323<br>3       mili    21      3       1111<br>4       tom     19      4       1212<br>5       mike    18      5       5555<br>NULL    NULL    NULL    6       6666<br>8       nul     20      NULL    NULL</pre><br>执行计划：<br>左表与右表均全量读取。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 2.2</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">full</span> <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">and</span> person.id=<span class="number">4</span>;</span><br></pre></td></tr></table></figure></p>
<p>执行结果：</p>
<p><pre>person.id       person.name     person.age      account.id      account.account<br>NULL    NULL    NULL    1       2222<br>NULL    NULL    NULL    2       2323<br>3       mili    21      NULL    NULL<br>NULL    NULL    NULL    3       1111<br>4       tom     19      4       1212<br>5       mike    18      NULL    NULL<br>NULL    NULL    NULL    5       5555<br>NULL    NULL    NULL    6       6666<br>8       nul     20      NULL    NULL</pre><br>执行计划：<br>左表与右表均全量读取。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 2.3</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">full</span> <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">and</span> account.id=<span class="number">4</span>;</span><br></pre></td></tr></table></figure></p>
<p>执行结果：</p>
<p><pre>同sql 2.2</pre><br>执行计划：<br>同sql 2.2.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 2.4</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">full</span> <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">where</span> person.id=<span class="number">4</span>;</span><br></pre></td></tr></table></figure></p>
<p>执行结果：</p>
<p><pre>person.id       person.name     person.age      account.id      account.account<br>4       tom     19      4       1212</pre><br>执行计划：<br>左表与右表均全量读取。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 2.5</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">full</span> <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">where</span> account.id=<span class="number">4</span>;</span><br></pre></td></tr></table></figure></p>
<p>执行结果：</p>
<p><pre>同sql 2.4</pre><br>执行计划：<br>同sql 2.4.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 2.6</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person <span class="keyword">full</span> <span class="keyword">join</span> <span class="keyword">account</span> <span class="keyword">on</span> person.id=account.id <span class="keyword">where</span> person.id=<span class="number">4</span> <span class="keyword">and</span> account.id=<span class="number">4</span>;</span><br></pre></td></tr></table></figure></p>
<p>执行结果：</p>
<p><pre>同sql 2.4</pre><br>执行计划：<br>同sql 2.4.</p>

  </article>
  <footer class="f-cf">
    
    
      <a href="/2021/03/16/hive-exercise-kuaishou/" class="link f-fr">一道快手数仓岗位的SQL题讲解⟶</a>
    
  </footer>
</section></div>
    <footer id="footer" class="f-cf">
  
  
  <span class="copyright">All rights reserved @ZHUIYUAN</span>
</footer>
  </div>
</body>
</html>